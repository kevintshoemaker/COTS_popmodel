source('~/GitHub/COTS_popmodel/COTSModel_GISFunctions.R', echo=TRUE)
source('~/GitHub/COTS_popmodel/COTSModel_PrepareGISlayers.R', echo=TRUE)
source('~/GitHub/COTS_popmodel/COTSModel_PrepareWorkspace.R', echo=TRUE)
setwd(SPATIALDATA_DIRECTORY)
reefpercent <- ReadRaster("reefpercent.asc", projection = projection, plot=T)
reefpercent <- ReadRaster("reefpercentRaster.asc", projection = projection, plot=T)
reefpercent.df <- data.frame(data.frame(x = coordinates(reefpercent)[,1], y = coordinates(reefpercent)[,2], reefpercent = reefpercent@data@values))
reefpercent.df <- subset(reefpercent.df, reefpercent>0)
coords <- reefpercent.df[,1:2]
sp <- SpatialPoints(coords = coords, proj4string = CRS(projection))
p1 <- plot(reefpercent, xlim=c(150,151), ylim=c(-22,23))
p1
plot(reefpercent, xlim=c(150,151), ylim=c(-22,23))
windows()
plot(reefpercent, xlim=c(150,151), ylim=c(-22,23))
plot(reefpercent, xlim=c(150,151), ylim=c(-22,-23))
plot(reefpercent, xlim=c(150,151), ylim=c(-23,-22))
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(sp, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
points(sp, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
points(sp, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
points(sp, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(reefshape, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), add = TRUE)
reefshape <- readShapefile("MarineBioregions_WGS84", projection = projection, plot=T)
crs(reefshape) <- crs(projection)
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(reefshape, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), add = TRUE)
reefraster <- rasterize(reefshape, template001, field = "BIOREGION")
template <- raster(ext=studyRegion,resolution=0.01,vals=0)   # create empty raster
minx <- min(PopData$x)-0.005  # farthest west
miny <- min(PopData$y)-0.005  # farthest south
maxx <- max(PopData$x)+0.005  # farthest east
setwd(ENVDATA_DIRECTORY)    # first load the xyz data for each population of interest
EnvData <- read.table("ENV_dataGBR.txt",header=T,sep="\t")
NPOPS <- nrow(EnvData)
# generate a template grid
head(EnvData)
minx <- min(EnvData$x)-0.005  # farthest west
miny <- min(EnvData$y)-0.005  # farthest south
maxx <- max(EnvData$x)+0.005  # farthest east
maxy <- max(EnvData$y)+0.005  # farthest north
studyRegion <- extent(minx,maxx,miny,maxy)
cat(sprintf("Western margin is %s degrees, southern margin is %s degrees, eastern margin is %s degrees, and northern margin is %s degrees",minx,miny,maxx,maxy))
plot(studyRegion, main="Study Region (blank)")
setwd(SPATIALDATA_DIRECTORY)
save(studyRegion,file="studyRegion.RData")
template <- raster(ext=studyRegion,resolution=0.01,vals=0)   # create empty raster
template001 <- raster(ext=studyRegion,resolution=0.001,vals=0)   # create empty raster at 0.001 res
reefraster <- rasterize(reefshape, template001, field = "BIOREGION")
reefraster001 <- rasterize(reefshape, template001, field = "BIOREGION")
reefraster001 <- rasterize(reefshape, template001, field = "BIOREGION")
setwd(SPATIALDATA_DIRECTORY)
writeRaster(reefraster,filename="reefraster001.asc",format="ascii",overwrite=T)   # write to file
reefraster001 <- rasterize(reefshape, template001, field = NA)
envcoords <- EnvData[,1:2]
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(reefraster001, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), add = TRUE)
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(reefshape, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), add = TRUE)
points(sp, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
envpoints <- SpatialPoints(coords = envcoords, proj4string = CRS(projection))
envcoords <- EnvData[,2:3]
envpoints <- SpatialPoints(coords = envcoords, proj4string = CRS(projection))
points(envpoints, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
plot(reefshape, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), add = TRUE)
points(sp, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), pch=20, col="blue")
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
points(sp, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), pch=20, col="blue", size=1)
plot(reefpercent, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2))
points(sp, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), pch=20, col="blue", cex=0.5)
points(envpoints, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), pch=17, col="red", cex=0.5)
plot(reefshape, xlim=c(150.2,150.5), ylim=c(-22.4,-22.2), add = TRUE)
vals <- over(sp, reefshape)
reeflines <- as(reefshape, 'SpatialLines')
vals <- over(reefpercent, reefshape)
vals <- over(sp, reefshape)
reefs <- cbind(coordinates(sp), vals, reefpercent = reefpercent.df[,3])
reef.NA <- subset(reefs, OBJECTID == NA)
reef.NA <- subset(reefs, OBJECTID == "NA")
reef.NA <- subset(reefs, OBJECTID = "NA")
reef.NA <- subset(reefs, OBJECTID < 1)
reef.NA <- subset(reefs, REED_ID != 1)
reef.NA <- subset(reefs, REEF_ID != 1)
reef.NA <- subset(reefs, is.na(REEF_ID))
reef.YES <- subset(reefs, !is.na(REEF_ID))
coordinates(reef.NA) <- ~x+y
coordinates(reef.NA) <- ~x+y; coordinates(reef.YES) <- ~x+y
reef.NA <- subset(reefs, is.na(REEF_ID))
reef.YES <- subset(reefs, !is.na(REEF_ID))
coordinates(reef.NA) <- ~x+y; coordinates(reef.YES) <- ~x+y
Gdist <- gDistance(reef.NA,reef.YES, byid = T)
loadPackages <- function(){
loadPackage("lhs")            # for latin hypercube sampling
loadPackage("RCurl")          # for loading source code from github
loadPackage("raster")         # for managing raster data
loadPackage("rgdal")          # for reading and writing all sorts of spatial data
loadPackage("popbio")         # for doing basic matrix population modeling
loadPackage("tidyverse")      # data manipulation
loadPackage("rgeos")          # geometry applications
}
loadPackages()
Gdist <- gDistance(reef.NA,reef.YES, byid = T)
save.image("C:/Users/jc312264/Dropbox/CoTS_Model/R_Workspaces/PrepareGISLayers_2016_09_28.RData")
