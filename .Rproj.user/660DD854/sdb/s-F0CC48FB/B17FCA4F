{
    "contents" : "########################\n# Functions for modeling COTS demography and dispersal\n########################\n#   Authors: Kevin Shoemaker, Sam Matthews\n#\n#   28 September 2016 - Updated initializeCoTSabund to matrix form\n#                     - started scripting mortality, fecundity, dispersal functions\n#\n#   THINGS TO DO:\n#         1. Set initial adult densities (use 1996 to line up with coral model) - check dates on report year\n#         2. Write out params of m,f and d functions\n#         3. Do we want to have CoTS pops at the reef level\n\n\n###################\n#  BASIC VITAL RATE AND GROWTH FUNCTIONS \n###################\n\n   # converts diameter (in mm) to mass (in grams)\n\nCOTS_MassFromDiam <- function(Diam){\n  Mass <- 6.29*10^-5*Diam^2.929\n  return(Mass)\n}\n\n   # converts female mass to total larval fecundity \nCOTS_FecFromMass <- function(Mass){\n  Fec <- 558*Mass^1.439\n  return(Fec)\n}\n\nCOTS_StableStage <- c(0.9803, 0.0171, 0.0026)   # very approximate stable stage distribution (J1, J2, Adult: see below for back-of-the-envelope calculation)\n\n###################\n# initializeCOTSabund\n##########\n# OBJECTIVE:\n#    generate an object for storing the COTS abundance in each pixel. \n# PARAMS:\n#    - reefmap: raster template for the study region: NA outside of reefs, reef ID value within reefs \n#    - initDensityA: for every reef in the study area, a vector of initial adult densities\n#    - initDensityS: for every reef in the study area, a vector of initial senile adult densities\n# RETURNS:\n#    - COTSabund: spatially-structured and stage-structured COTS abundance\n#           COTSabund$J_1: vector representing spatially structured abundance of Juvenile stage 1 individuals\n#           COTSabund$J_2: vector representing spatially structured abundance of Juvenile stage 2 individuals\n#           COTSabund$A: vector representing spatially structured abundance of reproductive adult individuals\n#           COTSabund$S: vector representing spatially structured abundance of senile adult individuals\n#           NOTE: larvae are not considered explicitly here. \n###################\n\n### for testing:\n### set small extent using crop function for testing\n\ninitializeCOTSabund <- function(reefID=reefID,uniquereefIDs=UNIQUEREEFIDS, stagenames, nstages, nreefs,npops,initDensityA,initDensityS){\n  \n     ### Set up the COTS abundance object\n  COTSabund <- matrix(0,nrow=npops, ncol=nstages)\n  colnames(COTSabund) <- stagenames\n\n  \n    ### set the initial abundances: \n  r=1\n  for(r in 1:nReefs){\n    thisReefID <- reefIDs[r]\n    mask <- reclassify(reefmap,rcl=c(NA,NA,0, -Inf,thisReefID-0.5,0, thisReefID-0.4,thisReefID+0.4,1, thisReefID+0.5,Inf,0))@data@values\n    COTSabund[,'A'] <- COTSabund[,'A'] + (mask*initDensityA[r])#use interpolated layers as starting point\n    COTSabund[,'S'] <- COTSabund[,'S'] + (mask*initDensityS[r])\n    totAdult <- initDensityA[r] + initDensityS[r]  \n    densJ2 <- totAdult * (COTS_StableStage[2]/COTS_StableStage[3])#correcting based on stable stage ratios\n    densJ1 <- totAdult * (COTS_StableStage[1]/COTS_StableStage[3])\n    COTSabund[,'J_1'] <- COTSabund[,'J_1'] + (mask*densJ1)\n    COTSabund[,'J_2'] <- COTSabund[,'J_2'] + (mask*densJ2)\n  }\n}\n    \n###################\n# CoTS_Mortality\n##########\n# OBJECTIVE:\n#    \n# PARAMS:\n#    \n# RETURNS: \n#     - newCOTSabund: COTS abund updated for stage specific mortality\n#     \n###################\n\n###################\n# CoTS_Fecundity\n##########\n# OBJECTIVE:\n#    \n# PARAMS:\n#    \n# RETURNS:\n#     - TotalLarvae: Total larvae produced per grid cell\n#     \n###################\n\n###################\n# CoTS_Dispersal\n##########\n# OBJECTIVE:\n#    \n# PARAMS:\n#    \n# RETURNS:\n#     - \n#     \n###################\n\n####################\n### COTS SANDBOX: for testing, etc.\n####################\n\n\n   ## build a very rough population transition matrix... \n\n#  typical reproductive female is 300 mm in diameter\n\nMass <- COTS_MassFromDiam(300)    # 1132 grams\nFec <- COTS_FecFromMass(Mass)     # each female produces approx 14 million larvae!\n\n  # assume that maybe 0.0001 of these larvae establish on a reef\nFec <- Fec*0.0001\n\nTransMat <- matrix(c(0,0.03,0,0,0,0,0.2,0,Fec/2,0,0.3,0.1,Fec/(2*6),0,0,0.6),nrow=4)\n\n\nlambda(TransMat)         # strong positive growth rate: 3.57\nstable.stage(TransMat)   #stable age distribution\n\n#### take away: stable stage distribution is heavily biased towards juveniles \n\n",
    "created" : 1474993714025.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3243122078",
    "id" : "B17FCA4F",
    "lastKnownWriteTime" : 1474996478,
    "path" : "~/GitHub/COTS_popmodel/COTSModel_COTSFunctions.R",
    "project_path" : "COTSModel_COTSFunctions.R",
    "properties" : {
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "type" : "r_source"
}