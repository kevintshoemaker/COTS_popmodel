{
    "contents" : "########################\n# CoTS Model -- AIMS LTMP Interpolation\n########################\n#   Authors: Sam Matthews\n#   \n#   28 September 2016 - Started scripting\n#\n#   This script interpolates The purpose of this script is to interpolate CoTS presence/abundance based \n#   on LTMP data for each year of collected data. Here I use the inverse distance weighted (IDW) \n#   interpolation method from the *gstat* package. The interpolation uses a fixed radius of 0.1 degree. \n#   Any cell in the grid which contained less than three points was assigned a ‘no data’ value.\n#\n#   The interpolation will only be applied to pixels that contain reef, and abundace values will be \n#   multiplied by the percentage of reef conatined within each cell.  \n#\n#\n#   THINGS TO DO:\n#         1. \n\n\n##################\n## 1. Load Data \n##################\n\nsetwd(DATA_DIRECTORY)\nmanta <- read.csv(\"ltmp/manta.csv\") #LTMP Manta Tow Data\n#PopData <- read.table(\"PopData.txt\", sep = \"\\t\") #our environmental data grid \nPopData <- read.table(\"XYZGrid.txt\", header = T, sep = \"\\t\")\n\n#we only need the ID variables for this process\n#PopData <- PopData[,-c(6:38)]\ncolnames(PopData)[1:2] <- c('x','y')\nPopData <- merge(PopData, RM.Sites.round1, by=c('x','y'),all=T)\n##################\n## 2. Summarise LTMP Data\n##################\n\ncolnames(manta)[6] <- \"LONG\"\nmanta_year <- ddply(manta, c(\"REEF_NAME\", \"LONG\", \"LAT\", \"REPORT_YEAR\"), \n                    summarise, mean_COTS = mean(COT_COUNT)) %>% \n                    dcast(REEF_NAME + LAT + LONG ~ REPORT_YEAR, value.var=\"mean_COTS\")\n\n##################\n## 3. Convert to Spatial Objects for use in the gstat package\n##################\n\ncoordinates(PopData) = ~ x + y\ngridded(PopData) = TRUE\n\n#for interpolation, each year has to have complete cases so I will have to write a function that \n#cuts up the data frame, removes incomplete cases and then passes it to idw function and eventually \n#spits out an interpolated data frame or Spatial Pixels Data Frame\n\n##################\n## 4. Interpolation Functions\n##################\n\nidw.interpolation <- function(Year, XYZ, maxdist, nmin) {\n  #first we need to subset the manta_year data set\n  Obs = na.omit(data.frame(manta_year[,2:3],manta_year[,Year-1983 +4])) #create observations of CoTS for year i\n  colnames(Obs)[3] = \"mean.COTS\"\n  coordinates(Obs) = ~LONG+LAT \n  COTS.idw = idw(mean.COTS~1, Obs, XYZ, maxdist = maxdist, nmin= nmin)\n  #results = spplot(COTS.idw[\"var1.pred\"], main = \"CoTS interpolation\")\n  return(COTS.idw)\n}\n\nidw.interpolation.df <- function(Year, XYZ, maxdist, nmin) { ## returns an interpolated Data Frame\n  #first we need to subset the manta_year data set\n  Obs = na.omit(data.frame(manta_year[,2:3],manta_year[,Year-1983 +4])) #create observations of CoTS for year i\n  colnames(Obs)[3] = \"mean.COTS\"\n  coordinates(Obs) = ~LONG+LAT \n  COTS.idw = as.data.frame(idw(mean.COTS~1, Obs, XYZ, maxdist = maxdist, nmin= nmin))\n  #results = spplot(COTS.idw[\"var1.pred\"], main = \"CoTS interpolation\")\n  return(COTS.idw)\n}\n\n##################\n## 5. Apply Interpolations\n##################\n\nYears <- 1983:2015\nCOTS.interpolation.df <- lapply(Years, FUN = idw.interpolation.df, XYZ=PopData, maxdist=1, nmin=3)\nnames(COTS.interpolation.df) <- Years #name the list so they can be retrieved by year\n\n##################\n## 5. COmbine Interpolations into one data fram\n##################\n\nfor(i in 1:length(COTS.interpolation.df)) names(COTS.interpolation.df[[i]])[3] <- paste0(\"X\",1982+i) \nfor(i in 1:length(COTS.interpolation.df)) COTS.interpolation.df[[i]][4] <- NULL\nCOTSInterp <- Reduce(function(x,y)merge(x,y, by=c(\"x\", \"y\")), COTS.interpolation.df)  \n\n#Add back in the PIXEL_ID, REEF_ID and Percetn reef\n#COTSInterp <- left_join(as.data.frame(PopData[,1:2]), COTSInterp, by=c(\"x\", \"y\"))\n\n#rearragne order of columns\n#COTSInterp <- COTSInterp[,c(1,4:5,2:3,6:38)]\n\n#write file\nsetwd(DATA_DIRECTORY)\nwrite.table(COTSInterp, file = \"COTS_Interpolated.txt\", row.names = F, sep=\"\\t\")\n\n#############\n# END SCRIPT\n#############\n\n\n",
    "created" : 1475114240029.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1409308772",
    "id" : "401F20F3",
    "lastKnownWriteTime" : 1475267456,
    "path" : "~/GitHub/COTS_popmodel/COTSModel_Interpolation.R",
    "project_path" : "COTSModel_Interpolation.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 6,
    "source_on_save" : false,
    "type" : "r_source"
}